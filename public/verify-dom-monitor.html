<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM Monitor V2 Quick Verification</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .pending { background-color: #fff3cd; color: #856404; }
        .results { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>DOM Monitor V2 Quick Verification</h1>
    
    <div id="status" class="status pending">Loading DOM Monitor...</div>
    <div id="results" class="results"></div>
    
    <button onclick="location.reload()" style="margin: 10px 0; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
        üîÑ Reload Test
    </button>

    <!-- Test elements -->
    <button id="test-btn">Test Button</button>
    <input type="text" placeholder="Test Input" id="test-input">
    
    <script src="assistant-loader.js"></script>
    
    <script>
        async function runVerification() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            let results = [];
            
            // Wait for DOM Monitor
            let attempts = 0;
            while ((!window.DOMMonitor || !window.AIAssistantDOMMonitor) && attempts < 60) {
                await new Promise(resolve => setTimeout(resolve, 500));
                attempts++;
            }
            
            if (!window.DOMMonitor || !window.AIAssistantDOMMonitor) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå DOM Monitor failed to load';
                return;
            }
            
            // Test 1: Check if DOMMonitor exists
            results.push(`‚úì window.DOMMonitor exists: ${!!window.DOMMonitor}`);
            results.push(`‚úì window.AIAssistantDOMMonitor exists: ${!!window.AIAssistantDOMMonitor}`);
            
            // Test 2: Check methods
            results.push(`‚úì isReady method exists: ${typeof window.AIAssistantDOMMonitor.isReady === 'function'}`);
            results.push(`‚úì refresh method exists: ${typeof window.AIAssistantDOMMonitor.refresh === 'function'}`);
            results.push(`‚úì getStatus method exists: ${typeof window.AIAssistantDOMMonitor.getStatus === 'function'}`);
            results.push(`‚úì getStats method exists: ${typeof window.AIAssistantDOMMonitor.getStats === 'function'}`);
            results.push(`‚úì getAllElements method exists: ${typeof window.AIAssistantDOMMonitor.getAllElements === 'function'}`);
            results.push(`‚úì findElements method exists: ${typeof window.AIAssistantDOMMonitor.findElements === 'function'}`);
            
            // Test 3: Check _internal access
            results.push(`‚úì _internal exists: ${!!window.AIAssistantDOMMonitor._internal}`);
            results.push(`‚úì _internal.monitor exists: ${!!window.AIAssistantDOMMonitor._internal?.monitor}`);
            results.push(`‚úì _internal.cache exists: ${!!window.AIAssistantDOMMonitor._internal?.cache}`);
            
            // Test 4: Try calling methods
            try {
                const isReady = window.AIAssistantDOMMonitor.isReady();
                results.push(`‚úì isReady() returned: ${isReady}`);
                
                const stats = window.AIAssistantDOMMonitor.getStats();
                results.push(`‚úì getStats() returned cache size: ${stats.cache?.totalElements || 0}`);
                
                const status = window.AIAssistantDOMMonitor.getStatus();
                results.push(`‚úì getStatus() returned: ${JSON.stringify(status).substring(0, 50)}...`);
                
                // Wait for initialization
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const elements = await window.AIAssistantDOMMonitor.getAllElements();
                results.push(`‚úì getAllElements() returned: ${elements.length} elements`);
                
                const buttons = await window.AIAssistantDOMMonitor.findElements('button');
                results.push(`‚úì findElements('button') returned: ${buttons.length} results`);
                
            } catch (error) {
                results.push(`‚úó Error calling methods: ${error.message}`);
            }
            
            // Display results
            resultsDiv.innerHTML = results.map(r => `<div>${r}</div>`).join('');
            
            // Update status
            const hasErrors = results.some(r => r.includes('‚úó') || r.includes('false'));
            if (hasErrors) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ö†Ô∏è DOM Monitor loaded with some issues';
            } else {
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ DOM Monitor V2 loaded successfully!';
            }
        }
        
        // Run verification
        runVerification();
    </script>
</body>
</html> 